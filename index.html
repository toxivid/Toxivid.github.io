<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chypr AI — Chat (Free AI)</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1724; --muted:#94a3b8; --accent:#10b981;
      --bubble-user:#ff3333; --bubble-ai:#111827; --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(180deg,#071028 0%, #071226 60%); color:#e6eef8; display:flex; justify-content:center; align-items:stretch; padding:24px;}
    .app{width:100%;max-width:980px;height:90vh;display:grid;grid-template-columns:260px 1fr;gap:18px;}
    .sidebar{background:var(--panel);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .brand{font-weight:700;font-size:18px;display:flex;align-items:center;gap:8px;}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);}
    .new-chat{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer;text-align:center;}
    .history{overflow:auto;padding-right:6px;display:flex;flex-direction:column;gap:8px;}
    .history .item{padding:8px;border-radius:8px;background:transparent;color:var(--muted);cursor:pointer;font-size:14px;}
    .history .item.active{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#fff;}
    .panel{background:rgba(255,255,255,0.02);border-radius:12px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 8px 24px rgba(2,6,23,0.5);}
    .topbar{padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.02);}
    .session-title{font-weight:600;letter-spacing:0.2px;}
    .spacer{flex:1;}
    .messages{flex:1;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:12px;}
    .bubble{max-width:78%;padding:12px 14px;border-radius:12px;line-height:1.45;white-space:pre-wrap;}
    .bubble.ai{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:#e6eef8; border-top-left-radius:4px; align-self:flex-start;}
    .bubble.user{background:linear-gradient(90deg, rgba(255,0,0,0.12), rgba(255,0,0,0.08)); color:#ff3333; border-top-right-radius:4px; align-self:flex-end;}
    .meta{font-size:12px;color:var(--muted);margin-bottom:6px;}
    .composer{padding:12px;border-top:1px solid rgba(255,255,255,0.02);display:flex;gap:8px;align-items:end;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);}
    textarea#prompt{flex:1;min-height:46px;max-height:180px;resize:vertical;padding:12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;font-size:15px;outline:none;}
    button#send{background:linear-gradient(180deg,var(--accent), #059669);border:none;color:#042018;font-weight:700;padding:10px 14px;border-radius:10px;cursor:pointer;}
    .small{font-size:13px;color:var(--muted);}
    .version-counter{position:fixed;bottom:8px;left:12px;font-size:12px;color:var(--muted);font-family:monospace;}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Chypr AI Chat">
    <aside class="sidebar">
      <div class="brand"><span class="dot"></span>Chypr AI</div>
      <div class="new-chat" id="newChat">＋ New chat</div>
      <div class="history" id="history"></div>
      <div style="margin-top:auto" class="small">Hosted on GitHub Pages · Free AI</div>
    </aside>

    <main class="panel">
      <div class="topbar">
        <div class="session-title" id="sessionTitle">Welcome to Chypr AI</div>
        <div class="spacer"></div>
        <div class="small" id="status">Ready</div>
      </div>

      <div class="messages" id="messages" role="log" aria-live="polite"></div>

      <div class="composer">
        <textarea id="prompt" placeholder="Send a message to Chypr AI..."></textarea>
        <button id="send">Send</button>
      </div>
    </main>
  </div>

  <div class="version-counter" id="versionCounter">Version 1.01</div>

<script>
(() => {
  const HF_MODEL = 'EleutherAI/gpt-neo-125M'; // Free public model, no token needed

  const apiFetch = async (text) => {
    const url = `https://api-inference.huggingface.co/models/${HF_MODEL}`;
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ inputs: text })
    });
    return res;
  };

  const messagesEl = document.getElementById('messages');
  const promptEl = document.getElementById('prompt');
  const sendBtn = document.getElementById('send');
  const statusEl = document.getElementById('status');
  const historyEl = document.getElementById('history');
  const newChatBtn = document.getElementById('newChat');
  const sessionTitle = document.getElementById('sessionTitle');
  const versionCounterEl = document.getElementById('versionCounter');

  let version = 1.01;
  function incrementVersion(){ version = Math.round((version+0.01)*100)/100; versionCounterEl.textContent='Version '+version.toFixed(2); }

  let sessionId = crypto.randomUUID();
  let chats = {};
  chats[sessionId] = { title: "New chat", messages: [] };

  function createBubble(role, text){
    const wrapper = document.createElement('div');
    const meta = document.createElement('div'); meta.className='meta';
    meta.textContent = role==='user' ? 'You' : 'Chypr AI';
    const bubble = document.createElement('div'); bubble.className = 'bubble ' + (role==='user' ? 'user' : 'ai');
    bubble.textContent = text;
    wrapper.appendChild(meta); wrapper.appendChild(bubble);
    return wrapper;
  }

  function renderMessages(){
    messagesEl.innerHTML = '';
    chats[sessionId].messages.forEach(m => messagesEl.appendChild(createBubble(m.role, m.text)));
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function addToHistoryList(){
    historyEl.innerHTML = '';
    for(const id of Object.keys(chats)){
      const it = document.createElement('div');
      it.className = 'item' + (id===sessionId ? ' active' : '');
      it.textContent = chats[id].title || 'Chat';
      it.onclick = () => { sessionId = id; sessionTitle.textContent = chats[id].title || 'Chat'; renderMessages(); addToHistoryList(); };
      historyEl.appendChild(it);
    }
  }

  async function sendMessage(text){
    if(!text.trim()) return;
    chats[sessionId].messages.push({role:'user', text});
    renderMessages();
    promptEl.value = '';
    setStatus('Thinking...');
    const loadingMeta = document.createElement('div'); loadingMeta.className='meta'; loadingMeta.textContent='Chypr AI';
    const loading = document.createElement('div'); loading.className='bubble ai'; loading.textContent='...';
    messagesEl.appendChild(loadingMeta); messagesEl.appendChild(loading);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    try {
      const res = await apiFetch(text);
      const data = await res.json();
      loading.remove(); loadingMeta.remove();

      let reply = "[no reply]";
      if (Array.isArray(data) && data[0]?.generated_text) {
        reply = data[0].generated_text;
      } else if (data?.generated_text) {
        reply = data.generated_text;
      } else if (data?.error) {
        reply = "Error: " + data.error;
      } else {
        reply = JSON.stringify(data);
      }

      chats[sessionId].messages.push({role:'assistant', text: reply});
      if(!chats[sessionId].title) chats[sessionId].title = text.substring(0,30);
      renderMessages();
      addToHistoryList();
      setStatus('Connected');
    } catch (err) {
      loading.textContent = 'Error: ' + err.message;
      setStatus('Error');
      console.error(err);
    }
  }

  function setStatus(t){ statusEl.textContent = t; }

  sendBtn.addEventListener('click', () => sendMessage(promptEl.value));
  promptEl.addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(promptEl.value); } });
  newChatBtn.addEventListener('click', () => {
    const id = crypto.randomUUID(); sessionId = id; chats[id] = { title: 'New chat', messages: [] };
    sessionTitle.textContent = 'New chat'; renderMessages(); addToHistoryList();
  });

  renderMessages(); addToHistoryList(); setStatus('Ready');
})();
</script>
</body>
</html>
